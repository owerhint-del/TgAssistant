# TgAssistant

Автоматический сервис для транскрибации и конспектирования видео из закрытых Telegram-каналов.

**Что делает:**
1. Ты вставляешь ссылку на видео/аудио из закрытого Telegram-канала
2. Сервис скачивает его через твой аккаунт
3. Расшифровывает речь в текст (почти дословно, с таймкодами)
4. Генерирует подробный структурированный конспект через Claude AI
5. Сохраняет всё в два PDF-файла

---

## Требования

Перед началом убедись, что на компьютере установлено:

- **Python 3.11+** (проверить: `python3 --version`) — минимум 3.11
- **Homebrew** (менеджер пакетов для macOS)
- **ffmpeg** (для обработки аудио)

---

## Установка (один раз)

### Шаг 1 — Установи Homebrew (если нет)

Открой Терминал и вставь эту команду, затем нажми Enter:

```
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```

Homebrew попросит ввести пароль от Mac — это нормально.

### Шаг 2 — Установи Python 3.11 и ffmpeg

```
brew install python@3.11 ffmpeg
```

### Шаг 3 — Перейди в папку проекта

```
cd /Users/valeriiabeiko/Projects/TgAssistant
```

### Шаг 4 — Создай виртуальное окружение и установи зависимости

```
python3.11 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

После этого в начале строки терминала появится `(.venv)` — это нормально.

---

## Первый запуск — получение ключей

Перед работой нужно получить два вида ключей:

### Ключи Telegram API (бесплатно, 2 минуты)

1. Открой в браузере: **https://my.telegram.org**
2. Введи свой номер телефона и войди
3. Нажми **"API development tools"**
4. Заполни форму:
   - App title: `TgAssistant` (или любое название)
   - Short name: `tgassistant`
   - Platform: `Desktop`
   - Остальное — не важно
5. Нажми **"Create application"**
6. Скопируй **App api_id** (число) и **App api_hash** (длинная строка)

### Ключ Anthropic (для Claude AI)

1. Открой: **https://console.anthropic.com/keys**
2. Нажми **"Create key"**
3. Скопируй ключ (начинается с `sk-ant-`)

---

## Настройка

Запусти мастер настройки:

```
source .venv/bin/activate
python run.py --setup
```

Мастер пошагово спросит:
- api_id и api_hash (из my.telegram.org)
- Номер телефона (твой Telegram)
- API ключ Anthropic
- Папку для сохранения PDF

После ввода данных Telegram пришлёт код на телефон — введи его в терминале.

**Это делается один раз.** После настройки сессия сохраняется локально.

---

## Использование

> Перед каждым запуском активируй виртуальное окружение:
> `source .venv/bin/activate`

### Одна ссылка

```
python run.py --link https://t.me/c/1775135187/1197
```

### Несколько ссылок подряд (режим watch)

```
python run.py --watch
```

Затем вставляй ссылки по одной и жми Enter. Для выхода — Ctrl+C.

### Проверить конфигурацию

```
python run.py --check-config
```

### Посмотреть историю

```
python run.py --status
python run.py --status --filter done
python run.py --status --filter error
```

### Повторить упавшую задачу

```
python run.py --retry <job_id>
```

job_id берётся из вывода `--status` (первые 8 символов достаточно).

Если хочешь начать обработку с нуля:
```
python run.py --retry <job_id> --from-start
```

---

## Где смотреть результат

PDF-файлы сохраняются в папку, которую ты указала при настройке.

По умолчанию: `/Users/valeriiabeiko/Documents/ПП для питомцев/`

Имена файлов:
```
2026-02-22_1775135187_1197_transcript.pdf   ← расшифровка
2026-02-22_1775135187_1197_summary.pdf      ← конспект
```

---

## Время обработки

| Длина видео | Транскрибация | Конспект | Итого |
|-------------|---------------|----------|-------|
| 30 мин | ~8–12 мин | ~1 мин | ~10–15 мин |
| 1 час | ~15–25 мин | ~2 мин | ~20–30 мин |
| 2 часа | ~30–50 мин | ~3 мин | ~35–55 мин |

При первом запуске Whisper скачивает модель (~3 ГБ) — это займёт 5–15 минут дополнительно.

---

## Что делать при ошибках

### "Сессия Telegram не найдена"
```
python run.py --setup
```

### "ffmpeg не найден"
```
brew install ffmpeg
```

### "Неверный ANTHROPIC_API_KEY"
1. Открой https://console.anthropic.com/keys
2. Создай новый ключ
3. Открой файл `.env` в текстовом редакторе
4. Замени значение `ANTHROPIC_API_KEY=`

### "Нет доступа к каналу"
Убедись, что твой Telegram-аккаунт состоит в этом канале.

### Другие ошибки
Подробный лог ошибок: `logs/tgassistant.log`

---

## Безопасность

- Файл `.env` содержит твои ключи — **не отправляй его никому**
- Папка `sessions/` содержит авторизованную сессию — **не удаляй и не публикуй**
- Подробнее: [SECURITY.md](SECURITY.md)

---

## Структура проекта

```
TgAssistant/
├── run.py              ← главная команда
├── .env                ← твои ключи (скрытый файл)
├── app/                ← код сервиса
├── sessions/           ← сессия Telegram (не трогать)
├── data/               ← база данных с историей
├── logs/               ← журнал событий
└── fonts/              ← шрифты для PDF
```
